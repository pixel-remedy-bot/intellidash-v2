// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String?   // For credentials provider
  image         String?
  emailVerified DateTime?
  
  // NextAuth relations
  accounts      Account[]
  sessions      Session[]
  
  // User preferences
  preferences   UserPreference?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// User preferences for dashboard customization
model UserPreference {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Dashboard layout preferences
  layout      String   @default("default") // JSON string for layout config
  theme       String   @default("system")  // light, dark, system
  
  // Widget preferences
  widgets     String   @default("[]")      // JSON array of enabled widgets
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// News articles aggregated from various sources
model News {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  url         String
  imageUrl    String?
  source      String   // e.g., "BBC", "CNN", "TechCrunch"
  category    String   // e.g., "technology", "business", "science"
  author      String?
  publishedAt DateTime
  
  // Content analysis
  sentiment   Float?   // -1 to 1 sentiment score
  summary     String?  @db.Text
  
  // Metadata
  trending    Boolean  @default(false)
  viewCount   Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([publishedAt])
  @@index([category])
  @@index([trending])
}

// Weather data for locations
model Weather {
  id          String   @id @default(cuid())
  location    String   // City name or coordinates
  country     String?
  latitude    Float
  longitude   Float
  
  // Current weather
  temperature Float    // Celsius
  feelsLike   Float?
  humidity    Int?     // Percentage
  pressure    Int?     // hPa
  windSpeed   Float?   // km/h
  windDirection Int?   // degrees
  visibility  Int?     // meters
  uvIndex     Float?
  
  // Weather condition
  condition   String   // e.g., "sunny", "cloudy", "rainy"
  description String?
  icon        String?  // Weather icon code
  
  // Forecast data (stored as JSON)
  forecast    String?  @db.Text // JSON array of forecast data
  
  // Metadata
  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  
  @@index([location])
  @@index([lastUpdated])
}

// Trending topics and search trends
model Trending {
  id          String   @id @default(cuid())
  keyword     String
  category    String   // e.g., "general", "tech", "entertainment", "business"
  
  // Trend metrics
  rank        Int      // Position in trending list
  volume      Int?     // Search volume
  growth      Float?   // Percentage growth
  
  // Source platform
  platform    String   // e.g., "google", "twitter", "youtube"
  region      String   @default("global") // Country code or "global"
  
  // Related data
  relatedTopics String? @db.Text // JSON array of related topics
  
  // Time tracking
  timestamp   DateTime @default(now())
  expiresAt   DateTime // When this trend becomes stale
  
  createdAt   DateTime @default(now())
  
  @@index([timestamp])
  @@index([category])
  @@index([platform])
  @@index([expiresAt])
}

// API usage tracking and rate limiting
model ApiUsage {
  id        String   @id @default(cuid())
  endpoint  String   // API endpoint name
  provider  String   // e.g., "openweather", "newsapi", "google-trends"
  requests  Int      @default(0)
  date      DateTime @default(now()) @db.Date
  
  createdAt DateTime @default(now())
  
  @@unique([endpoint, provider, date])
  @@index([date])
}
